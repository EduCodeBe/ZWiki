<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US"
      i18n:domain="zwiki"
      tal:define="
      title   string:${container/title} ${here/title_or_id} subscription;
      macros  python:here.wikipage_macros(request).macros;
      ">
<head metal:use-macro="macros/head">
  <title tal:content="title" metal:fill-slot="title" ></title>
  <meta name="robots" content="noindex,nofollow" metal:fill-slot="noindex" />
</head>
<body bgcolor="#ffffff">

<div metal:use-macro="macros/linkpanel"></div>

<table width="100%" border="0" cellspacing="0" cellpadding="3" tal:condition="python:0">
<tr>
<td width="1%" valign="middle">
<a 
tal:condition="python:request.get('zwiki_showlogo',1)"
tal:attributes="href here/wiki_url"
href="wiki_url" title="go to home page" accesskey="f">
<img 
tal:replace="structure container/site_logo|default"
src="/misc_/ZWiki/ZWikiPage_icon.gif" height="48" width="48" border="0" alt="home" />
</a>
</td>
<td valign="middle">
<h1 tal:content="string:${here/title_or_id} subscription">Page name subscription</h1>
</td>
</tr>
</table>
<!-- end of header -->
<div id="formcontent">

      <h1 tal:condition="here/inCMF"><span i18n:translate="">Mail subscription</span></h1>
      <span tal:condition="request/emailchanged|nothing">
        <!-- remember email address with a cookie like UserOptions -->
        <tal:dummy tal:define="r python:request.RESPONSE.setCookie(
                   'email',
                   request.email,
                   path='/',
                   expires=(here.ZopeTime() + 365).rfc822())
                   "/>
      </span>
      <form method="post" 
            enctype="multipart/form-data"
            action="page_url/subscribeform" 
            tal:attributes="action string:${here/page_url}/subscribeform"
            tal:define="
            email member/getUserName|request/email|nothing;
            pagesubscriber python:here.isSubscriber(email);
            wikisubscriber python:here.isWikiSubscriber(email);
            othersubscriptions python:here.otherPageSubscriptionsFor(email);
            split python:modules['string'].split;
            ">
        <p>
	  <span i18n:translate="subscribe_desc">
          You can subscribe to this page or to the whole wiki.
          Subscribers receive a copy of comments via email
          (but not general edits, unless enabled by the site admin).
          Or return to 
	  </span>
          <a href="page_url" tal:attributes="href here/page_url" 
             tal:content="here/title_or_id">Page name</a>.
        </p>

        <div tal:condition="here/inCMF">
          <input name="email" type="hidden" tal:attributes="value email" />
        </div>
        <div tal:condition="not:here/inCMF">
          <span i18n:translate="">Your email address</span>:
          <input name="email" type="text" size=30 value="email" tal:attributes="value email" />
          <input name="emailchanged" type="hidden" value="1" />
          <input class="context"
                 type="submit" 
                 name="../subscribeform:method" 
                 value="Change" 
		 i18n:attributes="value"
                 />
        </div>

        <div tal:condition="not:email" i18n:translate="subscribe_no_email">
          To subscribe, please configure your email address.
        </div>
        <table width="100%" cellpadding="2" cellspacing="1" border="0">
          <tr valign="top" tal:condition="email">
            <td valign="top" width="50%"
                tal:attributes="class python:
                (pagesubscriber and 'subscribed') or 'notsubscribed'">
              <br />
              <span tal:condition="pagesubscriber">
                <b i18n:translate="subscribed_page_ok">You are currently subscribed<br />
                to this page.</b>
              </span>
              <span tal:condition="not:pagesubscriber">
                <span i18n:translate="subscribed_page_no">You are currently not subscribed<br />
                You are currently not subscribed<br />
                to this page.</span>
              </span>
              <br />
              <input tal:condition="pagesubscriber" 
                     class="standalone"
                     type="submit" 
                     name="../unsubscribe:method" 
                     value=" Unsubscribe from pagename " 
		     i18n:attributes="value"
                     tal:attributes="value string: Unsubscribe from ${here/title_or_id} " 
                     />
              <input tal:condition="not:pagesubscriber" 
                     class="standalone"
                     type="submit" 
                     name="../subscribe:method" 
                     value=" Subscribe to pagename " 
	             i18n:attributes="value"
                     tal:attributes="value string: Subscribe to ${here/title_or_id} " 
                     />
            </td>
            <td valign="top" width="50%"
                tal:attributes="class python:
                (pagesubscriber and 'subscribed') or 'notsubscribed'">
              <br />
              <span tal:condition="wikisubscriber">
                <b i18n:translate="subscribed_wiki_ok">You are currently subscribed<br />
                to the whole wiki.</b>
              </span>
              <span tal:condition="not:wikisubscriber">
                <span i18n:translate="subscribed_wiki_no">You are currently not subscribed<br />
                to the whole wiki.</span>
              </span>
              <br />
              <input tal:condition="wikisubscriber" 
                     class="standalone"
                     type="submit" 
                     name="../wikiUnsubscribe:method" 
                     value="Unsubscribe from whole wiki" 
		     i18n:attributes="value"
                     />
              <input tal:condition="not:wikisubscriber" 
                     class="standalone"
                     type="submit" 
                     name="../wikiSubscribe:method" 
                     value="Subscribe to whole wiki" 
		     i18n:attributes="value"
                     />
            </td>
          </tr>
          <tr tal:condition="python:email and othersubscriptions">
            <td>
              <span i18n:translate="other_page_subscribed">You are subscribed to these other pages</span>: <br />
              <a tal:repeat="pageid othersubscriptions" 
                 href="../pageid/subscribeform?email=email"
                 tal:attributes="href python:
                 '%s/%s/subscribeform?email=%s' % (
                 here.wiki_url(),pageid,here.urlquote(email))"
                 tal:content="python:here.pageWithId(pageid).title_or_id()"
              >pagename</a>
            </td>
            <td>
              &nbsp;
            </td>
          </tr>

          <tr>
            <td valign="top" width="50%">
              <br />
              <span i18n:translate="">Page subscribers</span>:
              <br />
              <span tal:repeat="sub here/subscriberList">
                <span tal:replace="python:split(sub,'@')[0]"></span><br />
              </span>
            </td>
            <td valign="top" width="50%">
              <br />
              <span i18n:translate="">Wiki subscribers</span>:
              <br />
              <span tal:repeat="sub here/wikiSubscriberList">
                <span tal:replace="python:split(sub,'@')[0]"></span>
                <br />
              </span>
            </td>
          </tr>

        </table>
      </form>

</div>
</body>
</html>
