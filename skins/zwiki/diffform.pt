<html metal:use-macro="here/main_template/macros/master" i18n:domain="zwiki" >
  <head>
    <title metal:fill-slot="title_slot" tal:content="
                                                     string:${container/title} ${here/pageName} edit history" />
    <metal:block metal:fill-slot="head_slot">
      <metal:block metal:use-macro="here/macros/formsearchtags" />
    </metal:block>
  </head>
  <body>
    <!-- the diff browser -->
    <div metal:fill-slot="main"
         tal:define="rev        python:int(options['rev']);
                     revs       here/revisionCount;
                     pageurl    here/pageUrl;
                     revision   python:here.pageRevision(rev);
                     time       revision/lastEditTime;
                     log        revision/lastLog;
                     editor     revision/last_editor;
                     difftext   options/difftext;
                     ">
      <metal:macro metal:use-macro="here/macros/accesskeys" />
      <h1 i18n:translate="" tal:content="string:Edit detail for ${here/pageName} revision ${rev} of ${revs}" />
      <div class="formcontent">
        <table border=0 cellspacing=0 width="100%">
          <tr valign=top>

            <td align="left">
              <form tal:attributes="action here/pageUrl">
                <input type="submit" name="history:method" value="Return to edit history" i18n:attributes="value"/>
                <input tal:condition="python:0 #too confusing user.has_permission('View History',here)"
                       value="ZODB history" name="manage_UndoForm:method"
                       type="submit" i18n:attributes="value" />
              </form>
            </td>

            <td align="center">
              <form tal:attributes="action here/pageUrl">
                <input type="hidden" name="rev" tal:attributes="value rev" />
                <input tal:condition="python:rev>1"
                       name="prevDiff:method"
                       value=" &lt;&lt; "
                       type="submit" i18n:attributes="value" accesskey="p" />
                <input tal:condition="not:python:rev>1"
                       disabled="1"
                       value=" &lt;&lt; "
                       type="submit" i18n:attributes="value" accesskey="p" />
                <a tal:repeat="r python:range(1,revs+1)"
                   tal:content="r"
                   tal:attributes="href string:${pageurl}/diff?rev=${r};
                                   style python:rev==r and 'font-weight:bold' or '';
                                   " />
                <input tal:condition="python:rev<revs"
                       name="nextDiff:method"
                       value=" &gt;&gt; "
                       type="submit" i18n:attributes="value" accesskey="n" />
                <input tal:condition="not:python:rev<revs"
                       disabled="1"
                       value=" &gt;&gt; "
                       type="submit" i18n:attributes="value" accesskey="n" />
              </form>
              <form tal:attributes="action string:${pageurl}/diff" tal:condition="nothing">
                <input tal:repeat="r python:range(1,revs+1)"
                       tal:attributes="value r; style python:rev==r and 'font-weight:bold' or '';" />
              </form>
            </td>

            <td align="right">
              <form tal:attributes="action here/pageUrl">
                <input type="hidden" name="rev" tal:attributes="value rev" />
                <input tal:condition="python:user.has_permission('Zwiki: Edit pages', here)"
                       tal:attributes="disabled python:(rev==revs) and 1 or nothing;"
                       value="Revert to this version"
                       type="submit" name="revert:method"
                       i18n:attributes="value" />
              </form>
            </td>

          </tr>
          <tr valign=top>
            <td colspan=3>
              <span i18n:translate="">Editor:</span> <span tal:replace="editor" />
              <br />
              <span i18n:translate="">Time:</span> <span tal:replace="time" />
            </td>
          </tr>
          <tr valign=top>
            <td colspan=3>
              <span i18n:translate="">Note:</span> <span tal:content="log" style="font-weight:bold; font-style:italic;" />
            </td>
          </tr>
        </table>
        <hr />
        <pre tal:content="structure difftext"></pre>
        <hr />
        <div tal:content="structure python:revision(REQUEST=request,bare=1,show_subtopics=0)"></div>
      </div>
    </div>
  </body>
</html>
