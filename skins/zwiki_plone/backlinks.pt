<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns:tal="http://xml.zope.org/namespaces/tal"
       xmlns:metal="http://xml.zope.org/namespaces/metal"
       metal:use-macro="here/main_template/macros/master"
       i18n:domain="zwiki">
<body>


<div metal:fill-slot="main">	  

<span metal:use-macro="python:here.wikipage_macros().macros['quickaccesskeys']" />

<h1><span i18n:translate="">Backlinks for</span> <span tal:replace="here/Title">Pagename..</span></h1>

<tal:block define="
                   zwiki_showhierarchy request/zwiki_showhierarchy|nothing;
                   thispage here/Title;
                   ">
<p>
<span i18n:translate="">Here are the pages which link to</span> 
<a tal:attributes="href here/absolute_url; title here/linkTitle;" 
   tal:content="thispage"
   >thispage</a>:
</p>

<form action="reparent" tal:attributes="action string:${here/page_url}/reparent">

    <p tal:condition="zwiki_showhierarchy">
	<span i18n:translate="box_zwiki_showhierarchy">
    You can also set this page's <em>parent(s)</em>, to locate it within the
    contents hierarchy.  Check the boxes or enter a new page name and click
    Reparent.  A single parent is usually sufficient.
	</span>
    </p>

    <ol tal:define="
                    thisparents here/parents;
                    backlinks python:here.backlinksFor(thispage);
                    sorted_backlinks python:sequence.sort(backlinks, 
                                          (('Title', 'nocase', 'asc'),));
                   ">
               
        <li tal:repeat="bl sorted_backlinks"> 
        <tal:block define="
                           blpage bl/Title;
                           blisparent python:(blpage in thisparents) #and zwiki_showhierarchy;
                          ">
                          
        <input type="checkbox"
               name="parents" 
               value="blpage"
               tal:attributes="checked blisparent; value blpage;"
               tal:condition="zwiki_showhierarchy"/>

        <strong tal:omit-tag="not:blisparent">
             <a href="blurl" 
                title=""
		tal:define="blid bl/id"
		tal:attributes="href python:here.wiki_url()+'/'+blid;
                                title bl/linkTitle|nothing;"
                tal:content="blpage"
                >blpage</a>
        </strong>

        </tal:block>
        </li>
    </ol>

    <p tal:condition="zwiki_showhierarchy">
    <span i18n:translate="">Other parent</span>: <input type="text" name="parents"/>
    <input type="submit" value="Reparent" i18n:attributes="value" />
    </p>

</form>

</tal:block>

</div>

</body>
</html>
