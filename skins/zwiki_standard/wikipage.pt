<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US"
      i18n:domain="zwiki"
      >

  <head metal:define-macro="head">
    <meta http-equiv="Content-Type" content="" 
          tal:define="
            charset python:'utf-8';
            dummy   python:request.RESPONSE.setHeader(
                      'Content-Type','text/html;; charset='+charset);"
          tal:attributes="content string:text/html;;charset=${charset}" 
          />
    <span metal:define-slot="searchtags" 
          tal:omit-tag="" 
          tal:define="indexdelay python:24">
      <span tal:condition="python:here.lastEditIntervalInHours() >= indexdelay"
            tal:omit-tag="">
        <meta metal:define-slot="keywords" name="keywords" content=""
              tal:attributes="content here/spacedPageName;" />
        <meta metal:define-slot="description" name="description" content=""
              tal:attributes="content here/summary;" />
      </span>
      <span tal:condition="python:here.lastEditIntervalInHours() < indexdelay"
            tal:omit-tag="">
        <meta name="robots" content="noindex" />
      </span>
    </span>
    <span metal:define-slot="extra" tal:omit-tag="" 
          />
    <link rel="stylesheet" type="text/css" href="" 
          tal:attributes="href string:${here/defaultPageUrl}/stylesheet" 
          />
    <title metal:define-slot="title"
           tal:content="string:${container/title} ${here/pageName}">
      page title
    </title>
  </head>

  <body style="/*background-image:url(background.jpg);background-repeat:no-repeat;*/">

    <!--  optional extra site heading -->
    <div tal:condition="here/site_header|nothing" tal:replace="site_header" />


    <div metal:define-macro="linkpanel" tal:omit-tag="">

      <!-- always-available zwiki access keys -->
      <span metal:define-macro="accesskeys" tal:omit-tag="">
        <a tal:attributes="href string:${here/pageUrl}/src" accesskey="q"></a>
        <a tal:condition="nothing" tal:attributes="href string:${here/pageUrl}/clearCache" accesskey="w"></a>
        <a tal:attributes="href here/homeUrl" accesskey="f"></a>
        <a tal:attributes="href here/contentsUrl" accesskey="c"></a>
        <a tal:attributes="href here/changesUrl" accesskey="r"></a>
        <a tal:attributes="href here/discussionUrl" accesskey="" tal:condition="here/discussionUrl"></a>
        <a tal:attributes="href here/trackerUrl" accesskey="t" tal:condition="here/hasIssues"></a>
        <a tal:attributes="href here/indexUrl" accesskey="i" tal:condition="here/indexUrl"></a>
        <a tal:attributes="href here/uploadsUrl" accesskey="" tal:condition="python:0 #here/uploadsUrl"></a>
        <a tal:attributes="href here/preferencesUrl" accesskey="o"></a>
        <a tal:attributes="href here/helpUrl" accesskey="h" tal:condition="here/helpUrl"></a>
        <a tal:attributes="href python:here.pageUrl()+'/setskin?skin=standard'" accesskey="-" tal:condition="here/inCMF"></a>
        <a tal:attributes="href python:here.pageUrl()+'/setskin?skin=plone'" accesskey="+" tal:condition="here/inCMF"></a>
        <a tal:attributes="href here/pageUrl" accesskey="v"></a>
        <a tal:attributes="href string:${here/pageUrl}/subscribeform" accesskey="m"></a>
        <a tal:attributes="href string:${here/pageUrl}/backlinks" accesskey="b"></a>
        <a tal:attributes="href string:${here/pageUrl}/diff" accesskey="d"></a>
        <a tal:attributes="href string:${here/pageUrl}/manage_change_history_page" accesskey="y"></a>
        <a tal:attributes="href string:${here/pageUrl}/editform" accesskey="e"></a>
        <a tal:attributes="href python:here.wikiUrl() + '/externalEdit_/' +
                           modules['Products.PythonScripts.standard'].url_quote(here.id()) +
                           '?borrow_lock=1'" accesskey="x"></a>
        <a tal:condition="nothing" tal:attributes="href string:${here/pageUrl}/print" accesskey=""></a>
        <a tal:attributes="href string:#subtopics" accesskey=""></a>
        <a tal:attributes="href python:here.nextPageUrl() or here.firstPageUrl()" accesskey="n"></a>
        <a tal:attributes="href python:here.previousPageUrl() or here.lastPageUrl()" accesskey="p"></a>
        <a tal:attributes="href here/upUrl" accesskey="u"></a>
        <a tal:attributes="href string:${here/pageUrl}/showAccessKeys" accesskey="0"></a>
      </span>

      <!-- main links bar -->
      <div class="linkpanel">
        <table class="shade1" width="100%" border="0" cellspacing="0">
          <tr>
            <td class="otherlinks" align="right">

              <!-- wiki navigation -->
              <span metal:define-macro="wikilinks" tal:omit-tag="">
                <a href="" tal:attributes="href here/homeUrl" 
                   accesskey="f"
                   title="show front page"
                   i18n:attributes="title">
                <span i18n:translate="">home</span></a>
                <a href="" tal:attributes="href here/changesUrl" 
                   accesskey="r"
                   title="show wiki recent changes"
                   i18n:attributes="title">
                <span i18n:translate="">changes</span></a>
                <a href="" tal:attributes="href here/discussionUrl" 
                   tal:condition="here/discussionUrl"
                   title="show discussion page"
                   i18n:attributes="title">
                <span i18n:translate="">discussion</span></a>
                <a href="" tal:attributes="href here/trackerUrl" 
                   tal:condition="here/hasIssues"
                   title="show issue tracker"
                   i18n:attributes="title">
                <span i18n:translate="">issues</span></a>
                <a href="" tal:attributes="href here/contentsUrl" 
                   accesskey="c"
                   title="show wiki contents"
                   i18n:attributes="title">
                <span i18n:translate="">contents</span></a>
                <a tal:attributes="href here/indexUrl" accesskey="i" 
                   tal:condition="here/indexUrl"
                   title="show wiki index"
                   i18n:attributes="title">
                <span i18n:translate="">index</span></a>
                <a href="" tal:attributes="href here/uploadsUrl" 
                   tal:condition="here/uploadsUrl"
                   title="show upload page"
                   i18n:attributes="title">
                <span i18n:translate="">uploads</span></a>
                <a tal:attributes="href here/preferencesUrl" 
                   accesskey="o"
                   title="show wiki options"
                   i18n:attributes="title">
                <span i18n:translate="">options</span></a>
                <a tal:attributes="href here/helpUrl" 
                   accesskey="h" 
                   tal:condition="here/helpUrl"
                   title="show help page"
                   i18n:attributes="title">
                <span i18n:translate="">help</span></a>
              </span>
              -
              <!-- page actions -->
              <span metal:define-macro="pagelinks">
                <a tal:condition="python:0"
                   tal:attributes="href python:here.pageUrl() + '/backlinks';"
                   href="" 
                   title="which pages link to this one ?" 
                   i18n:attributes="title"
                   accesskey="b"
                   ><span i18n:translate="">backlinks</span></a>
                <a tal:condition="python:here.isMailoutEnabled()"
                   tal:attributes="href python:here.page_url() + '/subscribeform'"
                   href="page_url/subscribeform" 
                   accesskey="m"
                   title="configure email subscription to this page or site" 
                   i18n:attributes="title"
                   >
                  <span tal:condition="python:0 
                              #here.allSubscriptionsFor(request.get('email',''))
                              #show subscription status - too expensive " >(un)</span >
                  <span i18n:translate="">subscribe</span></a>
                <a tal:condition="python:0 #user.has_permission('Zwiki: Edit pages',here)"
                   tal:attributes="href python:here.pageUrl() + '/diff';"
                   href="" 
                   title="show this page's change history" 
                   i18n:attributes="title"
                   accesskey="d"
                   ><span i18n:translate="">diff</span></a>
                <a tal:condition="python:user.has_permission('Zwiki: Edit pages',here)"
                   tal:attributes="
                    href python:here.page_url() + '/editform';
                    title python: here.translateHelper('edit-page') + ' (' + here.linkTitle() + ')'"
                   href="page_url/editform" 
                   title="edit this page (last edited n days ago by so-and-so)"
                   accesskey="e"
                   >
                <span i18n:translate="">edit</span></a>
                <a tal:condition="python:
                    user.has_permission('Zwiki: Edit pages',here) and
                    hasattr(root.misc_,'ExternalEditor') and
                    user.has_permission('Use external editor',here)"
                   tal:attributes="href python:
                    here.wiki_url() + '/externalEdit_/' +
                    modules['Products.PythonScripts.standard'].url_quote(here.id()) +
                    '?borrow_lock=1'"
                   href="wiki_url/externalEdit_/id" 
                   title="edit using external editor" 
                   i18n:attributes="title"
                   accesskey="x"
                   ><img src="/misc_/ExternalEditor/edit_icon" hspace="2" align="middle" 
                   border="0" alt="(external edit)" i18n:attributes="alt" /></a>
              </span>

            </td>
          </tr>
        </table>
      </div> 
    </div> 


    <!-- hierarchy navigation bar - off by default -->
    <div metal:define-macro="navpanel" tal:omit-tag="" tal:condition="python:0">
      <div class="navpanel">
        <table class="shade1" width="100%" border="0" cellspacing="0">
          <tr valign="top">
            <td align="left" width="33%">
              <a tal:condition="here/previousPage" tal:attributes="href here/previousPageUrl"
                 access_key='P' tal:content="python:'&lt;&lt;'+here.previousPage()">
                << PreviousPage
              </a>
            </td>
            <td align="center" width="33%">
              <a tal:condition="here/primaryParentName" 
                 tal:attributes="href here/upUrl"
                 access_key='U' 
                 tal:content="python:'^^'+(here.primaryParentName() or 'wiki contents')">
                ^^ParentPage
              </a>
            </td>
            <td align="right" width="33%">
              <a tal:condition="here/nextPage" tal:attributes="href here/nextPageUrl"
                 access_key='N' tal:content="python:here.nextPage()+'&gt;&gt;'">
                >>NextPage
              </a>
            </td>
          </tr>
        </table>
      </div>
    </div>


    <!-- page heading -->
    <div class="pageheading">
      <form method="GET" 
            tal:define="
                        methodname string:searchwiki;
                        pagename string:SearchPage; 
                        page python:here.pageWithName(pagename);
                        pagehasdtml python:page and page.dtmlAllowed() and page.hasDynamicContent();
                        url python:(pagehasdtml and page.id()) or (here.defaultPageId()+'/'+methodname);
                        "
            tal:attributes="action python:here.wiki_url()+'/'+url;"
            action="">
        <table width="100%" border="0" cellspacing="0">
          <tr>
            <!-- logo -->
            <td id="logo" width="1%" valign="top" class="logo_full">
              <span metal:define-macro="logolink" tal:omit-tag="">
                <a tal:attributes="href here/wiki_url"
                   title="go to home page" 
                   i18n:attributes="title"
                   accesskey="f">
                  <img src="/misc_/ZWiki/ZWikiPage_icon.gif" height="48" width="48" 
                       border="0" alt="home" i18n:attributes="alt"
                       tal:replace="structure here/site_logo|default" /></a>
              </span>
            </td>
            <!-- page name (and parents) -->
            <td class="pagenameand" align="left" width="79%">
              <span metal:define-macro="pagenameand" tal:omit-tag="">
                <ul tal:replace="structure 
                                 python:here.context(request,enlarge_current=1)">
                  <li>context<ul><li><big><big><big>page name</big></big></big></li></ul></li>
                </ul>
              </span>
            </td>
            <!-- search form & page info -->
            <td class="searchbox" width="20%" align="right">
              <input id="searchinput" class="formfield" 
                     name="expr" type="text" size="20" maxlength="100" value="" 
                     title="search all pages" accesskey="s" i18n:attributes="title" /><br />
              <span class="lasteditor" 
                    tal:content="structure python:here.linkTitle(prettyprint=1)">
                last edited n days ago by by so-and-so
              </span>
            </td>
          </tr>
        </table>
      </form>
    </div>

    <!-- rating form (should be part of page info) -->
    <div align="right">  
      <span tal:condition="python:user.has_permission('Zwiki: Rate pages',here)" 
            tal:replace="structure here/ratingform">
        rating form
      </span>
    </div>


    <div class="content">

      <!-- page content (main text, subtopics links, comments) -->
      <div tal:replace="structure options/body">
        page body, subtopics, comments
      </div>
      <a name="bottom"></a><br />

      <!-- comment form -->
      <div tal:condition="python:user.has_permission('Zwiki: Add comments',here)">
        <br />
        <br />
        <div metal:define-macro="commentform">
          <form method="post" enctype="multipart/form-data"
                class="commentform" style="margin-top:0;margin-bottom:0"
                tal:attributes="action here/pageUrl">
            <input name="timeStamp" type="hidden" value="editTimestamp"
                   tal:attributes="value here/editTimestamp" />
            <input name="page" type="hidden" value="id" 
                   tal:attributes="value here/id" />
            <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="">
              <tr>
                <td align="left" valign="middle" nowrap="nowrap" colspan="2">
                  <small>
                    <span i18n:translate="">subject</span>: 
                    <input type="text" name="subject_heading" value="" 
                           size="40" maxlength="100" style="font-weight:bold;" 
                           class="formfield" 
                           title="a subject helps clarify threads and RecentChanges" 
                           i18n:attributes="title" 
                           tal:attributes="value request/subject|nothing" />
                    <span tal:condition="request/in_reply_to|nothing">
                      (<span i18n:translate="">replying</span>)
                    </span>
                  </small>
                </td>
              </tr>
              <tr>
                <td align="center" valign="bottom" bgcolor="" colspan="2">
                  <textarea wrap="virtual" name="text" rows="3" cols="60" 
                            style="width:100%;"  class="formfield"
                            title="to comment (and cc any subscribers) enter text here and click add"
                            i18n:attributes="title"
                  ></textarea>
                </td>
              </tr>
              <tr>
                <td align="left" valign="middle">
                  &nbsp;
                </td>
                <td align="right" valign="top" nowrap="nowrap"> 
                  <input type="hidden" name="in_reply_to"
                         tal:attributes="value request/in_reply_to|nothing" />
                  <input type="hidden" name="use_heading" value="1" />
                  <span tal:condition="python:here.isMailoutEnabled()" >
                    <small>(
                    <span tal:define="nbsubscriber 
                                      python:here.subscriberCount() + here.wikiSubscriberCount()">
                      <span tal:condition="python:nbsubscriber>1" i18n:translate="">
                        <span tal:content="python:str(nbsubscriber)" i18n:name="nb" /> subscribers
                      </span>
                      <span tal:condition="python:nbsubscriber==1" i18n:translate="">
                        1 subscriber
                      </span>
                    </span>
                    )</small>
                  </span>
                  <input type="submit" name="comment:method" value="add a comment" 
                         i18n:attributes="value add-comment"
                         style="font-weight:bold" /></td>
              </tr>
            </table>
          </form>
        </div>
      </div>

    </div>


    <!-- page management form -->
    <div tal:condition="python:
           (user.has_permission('Zwiki: Add pages',here) or
           user.has_permission('Zwiki: Rename pages',here) or
           user.has_permission('Zwiki: Reparent pages',here) or
           user.has_permission('Zwiki: Delete pages',here))
           #and here.userIsIdentified()
           ">
      <br />
      <div metal:define-macro="pagemanagementform" tal:omit-tag="">
        <form method="post" action="" enctype="multipart/form-data"
              tal:attributes="action here/page_url" 
              style="margin-top:0;margin-bottom:0">
          <table border="0" cellspacing="0" cellpadding="1" align="center"
                 class="shade1" width="100%" style="font-size:90%;"
                 >
            <tr>
              <td align="left" valign="top">
                <!-- help text -->
                <span i18n:translate="">new</span> 
                <span i18n:translate=""
                      tal:condition="python:user.has_permission('Zwiki: Reparent pages',here) and here.userIsIdentified()" 
                      >parent, </span>
                <span i18n:translate=""
                      tal:condition="python:user.has_permission('Zwiki: Rename pages',here) and here.userIsIdentified()" 
                      >name, </span>
                <span i18n:translate=""
                      tal:condition="python:user.has_permission('Zwiki: Delete pages',here) and here.userIsIdentified()" 
                      >replacement, </span>
                <span i18n:translate=""
                      tal:condition="python:user.has_permission('Zwiki: Add pages',container)"
                      >subtopic</span
                      ><span tal:condition="not:here/inCMF" tal:omit-tag="">:</span>
                <span tal:condition="here/inCMF" tal:omit-tag="" comment="cmf/plone layout hint"
                      ><span i18n:translate="">for this page</span>:<br />
                </span>
                <!-- multi-purpose input field and buttons -->
                <input name="pagename" type="text" size="25" maxlength="100" value="" 
                       class="formfield"
                       title="enter a page name and click buttons to the right (mouse over for help)"
                       i18n:attributes="title"
                /><span style="white-space:nowrap;"
                ><input type="submit" name="reparent:method" value="reparent" 
                        style="font-weight:normal;"
                        title="make this page a subtopic of the page you have entered"
                        i18n:attributes="value title"
                        tal:condition="python:user.has_permission('Zwiki: Reparent pages',here) and here.userIsIdentified()" 
                /><input type="submit" name="rename:method" value="rename" 
                         style="font-weight:normal" 
                         title="rename this page to the name you have entered, updating all links"
                         i18n:attributes="value title"
                         tal:condition="python:user.has_permission('Zwiki: Rename pages',here) and here.userIsIdentified()" 
                /><input type="submit" name="delete:method" value="delete!" 
                         style="font-weight:normal"
                         title="delete this page, and redirect links to the page you have entered, if any"
                         i18n:attributes="value title"
                         tal:condition="python:user.has_permission('Zwiki: Delete pages',here) and here.userIsIdentified()" 
                /><input type="submit" name="createform:method" value="create" 
                         style="font-weight:normal"
                         title="create a page with the name you have entered, as a subtopic of this one"
                         i18n:attributes="value title"
                         tal:condition="python:user.has_permission('Zwiki: Add pages',container)" 
                /></span>
              </td>
            </tr>
          </table>
        </form>
      </div>
    </div>

    
  </body>
</html>
